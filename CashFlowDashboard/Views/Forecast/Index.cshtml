@model CashFlowDashboard.ViewModels.ForecastViewModel

@{
    ViewData["Title"] = Model.PageTitle;
}

<style>
    /* Custom chart styles for the generated grid */
    .chart-grid {
        background-image: linear-gradient(to right, #f3f4f6 1px, transparent 1px), linear-gradient(to bottom, #f3f4f6 1px, transparent 1px);
        background-size: 40px 40px;
    }

    .dark .chart-grid {
        background-image: linear-gradient(to right, #374151 1px, transparent 1px), linear-gradient(to bottom, #374151 1px, transparent 1px);
    }
    
    /* Smooth transition for hover effects */
    .hover-lift {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .hover-lift:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
</style>

<div class="flex-1 overflow-y-auto p-6 md:p-8">
    <div class="max-w-[1400px] mx-auto h-full flex flex-col gap-6">
        <!-- Filter Toolbar -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div class="flex items-center bg-white dark:bg-surface-dark rounded-lg p-1 border border-slate-200 dark:border-slate-800 shadow-sm">
                <button class="px-4 py-1.5 rounded text-sm font-medium text-slate-500 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white transition-colors">30 Days</button>
                <button class="px-4 py-1.5 rounded bg-primary text-white shadow-sm text-sm font-bold transition-all">60 Days</button>
                <button class="px-4 py-1.5 rounded text-sm font-medium text-slate-500 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white transition-colors">90 Days</button>
                <div class="w-px h-4 bg-slate-200 dark:bg-slate-700 mx-1"></div>
                <button class="px-4 py-1.5 rounded text-sm font-medium text-slate-500 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white transition-colors">Custom</button>
            </div>
            <div class="flex items-center gap-3">
                <div class="hidden md:flex items-center gap-2 px-3 py-2 bg-white dark:bg-surface-dark rounded-lg border border-slate-200 dark:border-slate-800 text-sm font-medium text-slate-900 dark:text-white shadow-sm cursor-pointer hover:border-primary transition-colors">
                    <span class="material-symbols-outlined text-primary">filter_alt</span>
                    <span>Filter: All Accounts</span>
                </div>
                <button class="flex items-center gap-2 px-4 py-2 bg-white dark:bg-surface-dark rounded-lg border border-slate-200 dark:border-slate-800 text-sm font-bold text-slate-900 dark:text-white shadow-sm hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                    <span class="material-symbols-outlined text-lg">download</span>
                    <span class="hidden sm:inline">Export Report</span>
                </button>
                <button class="flex items-center gap-2 px-4 py-2 bg-primary rounded-lg text-sm font-bold text-white shadow-md hover:bg-primary-dark transition-colors">
                    <span class="material-symbols-outlined text-lg">add</span>
                    <span>New Scenario</span>
                </button>
            </div>
        </div>
        <!-- Main Grid Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 h-full min-h-[600px]">
            <!-- Chart Section (Left - Dominant) -->
            <div class="lg:col-span-8 flex flex-col gap-6">
                <!-- Main Chart Card -->
                <div class="bg-white dark:bg-surface-dark rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 p-6 flex flex-col flex-1 min-h-[500px] relative overflow-hidden group">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h3 class="text-lg font-bold text-slate-900 dark:text-white">Projected Cash Flow</h3>
                            <p class="text-sm text-slate-500">Based on recurring revenue &amp; historical burn rate.</p>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 rounded-full bg-primary"></div>
                                <span class="text-xs font-medium text-slate-900 dark:text-slate-300">Projected</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 rounded-full border-2 border-dashed border-slate-400"></div>
                                <span class="text-xs font-medium text-slate-900 dark:text-slate-300">Historical</span>
                            </div>
                        </div>
                    </div>
                    <!-- Interactive Chart Visualization (Simulated with HTML/CSS) -->
                    <div class="relative flex-1 w-full chart-grid rounded-lg border border-dashed border-slate-200 dark:border-slate-700">
                        <!-- Y Axis Labels -->
                        <div class="absolute left-0 top-0 bottom-8 flex flex-col justify-between text-xs text-slate-500 pr-2 h-full py-4 pl-2 z-10 bg-white/50 dark:bg-surface-dark/50 backdrop-blur-sm w-12 border-r border-slate-100 dark:border-slate-800">
                            <span>$200k</span>
                            <span>$150k</span>
                            <span>$100k</span>
                            <span>$50k</span>
                            <span>$0</span>
                        </div>
                        <!-- X Axis Labels -->
                        <div class="absolute left-12 right-0 bottom-0 h-8 flex justify-between items-center px-4 text-xs text-slate-500 border-t border-slate-100 dark:border-slate-800">
                            <span>Oct 1</span>
                            <span>Oct 15</span>
                            <span>Nov 1</span>
                            <span>Nov 15</span>
                            <span>Dec 1</span>
                            <span>Dec 15</span>
                        </div>
                        <!-- Chart Content Area -->
                        <div class="absolute top-4 bottom-8 left-12 right-4 overflow-hidden">
                            <!-- Historical Line (Dashed) -->
                            <svg class="w-full h-full overflow-visible" preserveaspectratio="none" viewbox="0 0 100 100">
                                <!-- Gradient Definition -->
                                <defs>
                                    <lineargradient id="chartGradient" x1="0" x2="0" y1="0" y2="1">
                                        <stop offset="0%" stop-color="#266c73" stop-opacity="0.2"></stop>
                                        <stop offset="100%" stop-color="#266c73" stop-opacity="0"></stop>
                                    </lineargradient>
                                </defs>
                                <!-- Historical Path -->
                                <path d="M0,70 Q10,65 20,68 T40,60" fill="none" stroke="#9ca3af" stroke-dasharray="4,4" stroke-width="2"></path>
                                <!-- Projected Area -->
                                <path d="M40,60 C50,55 60,40 70,45 S90,20 100,15 L100,100 L40,100 Z" fill="url(#chartGradient)"></path>
                                <!-- Projected Line -->
                                <path d="M40,60 C50,55 60,40 70,45 S90,20 100,15" fill="none" stroke="#266c73" stroke-linecap="round" stroke-width="3"></path>
                                <!-- Current Date Marker -->
                                <line stroke="#266c73" stroke-dasharray="2,2" stroke-width="1" x1="40" x2="40" y1="0" y2="100"></line>
                                <circle cx="40" cy="60" fill="#266c73" r="4" stroke="white" stroke-width="2"></circle>
                                <!-- Hover Point (Simulated) -->
                                <g class="opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                    <line stroke="#266c73" stroke-width="1" x1="70" x2="70" y1="0" y2="100"></line>
                                    <circle cx="70" cy="45" fill="#fff" r="5" stroke="#266c73" stroke-width="3"></circle>
                                </g>
                            </svg>
                            <!-- Floating Tooltip (Simulated Position) -->
                            <div class="absolute top-[30%] left-[68%] bg-white dark:bg-surface-dark shadow-lg rounded-lg p-3 border border-slate-200 dark:border-slate-700 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0 pointer-events-none z-20 w-40">
                                <div class="text-xs text-slate-500 mb-1">Nov 15, 2023</div>
                                <div class="text-lg font-bold text-slate-900 dark:text-white">$142,500</div>
                                <div class="flex items-center gap-1 mt-1 text-xs text-emerald-600 font-medium">
                                    <span class="material-symbols-outlined text-sm">trending_up</span>
                                    <span>+12.5% vs prev</span>
                                </div>
                            </div>
                            <!-- Current Marker Label -->
                            <div class="absolute top-0 left-[38%] -translate-x-1/2 bg-primary text-white text-[10px] font-bold px-2 py-0.5 rounded-full z-10 shadow-sm">
                                TODAY
                            </div>
                        </div>
                    </div>
                    <!-- Scenario Toggles Bottom -->
                    <div class="mt-6 pt-4 border-t border-slate-200 dark:border-slate-800 flex gap-6">
                        <label class="flex items-center gap-2 cursor-pointer group">
                            <div class="relative inline-flex items-center h-5 rounded-full w-9 transition-colors focus:outline-none bg-primary">
                                <span class="translate-x-4.5 inline-block w-3.5 h-3.5 transform bg-white rounded-full transition-transform translate-x-5"></span>
                            </div>
                            <span class="text-sm font-medium text-slate-900 dark:text-white group-hover:text-primary transition-colors">Base Case</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer group">
                            <div class="relative inline-flex items-center h-5 rounded-full w-9 transition-colors focus:outline-none bg-slate-200 dark:bg-slate-700">
                                <span class="translate-x-0.5 inline-block w-3.5 h-3.5 transform bg-white rounded-full transition-transform"></span>
                            </div>
                            <span class="text-sm font-medium text-slate-500 group-hover:text-slate-900 dark:group-hover:text-white transition-colors">Optimistic</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer group">
                            <div class="relative inline-flex items-center h-5 rounded-full w-9 transition-colors focus:outline-none bg-slate-200 dark:bg-slate-700">
                                <span class="translate-x-0.5 inline-block w-3.5 h-3.5 transform bg-white rounded-full transition-transform"></span>
                            </div>
                            <span class="text-sm font-medium text-slate-500 group-hover:text-slate-900 dark:group-hover:text-white transition-colors">Pessimistic</span>
                        </label>
                    </div>
                </div>
            </div>
            <!-- Insights Panel (Right) -->
            <div class="lg:col-span-4 flex flex-col gap-6">
                <!-- Summary Cards Grid -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white dark:bg-surface-dark p-4 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm hover-lift">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="material-symbols-outlined text-primary text-xl">account_balance_wallet</span>
                            <span class="text-xs font-bold text-slate-500 uppercase tracking-wider">End Cash</span>
                        </div>
                        <div class="text-2xl font-bold text-slate-900 dark:text-white">$145.2k</div>
                        <div class="text-xs text-emerald-600 font-medium mt-1">â†‘ 4.2% projected</div>
                    </div>
                    <div class="bg-white dark:bg-surface-dark p-4 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm hover-lift">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="material-symbols-outlined text-orange-500 text-xl">local_fire_department</span>
                            <span class="text-xs font-bold text-slate-500 uppercase tracking-wider">Burn Rate</span>
                        </div>
                        <div class="text-2xl font-bold text-slate-900 dark:text-white">$12.4k</div>
                        <div class="text-xs text-slate-500 mt-1">/ month avg</div>
                    </div>
                </div>
                <!-- Forecast Insights Text Panel -->
                <div class="bg-white dark:bg-surface-dark rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm flex-1 flex flex-col">
                    <div class="p-5 border-b border-slate-200 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/30 rounded-t-xl">
                        <h3 class="text-base font-bold text-slate-900 dark:text-white flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">lightbulb</span>
                            Forecast Insights
                        </h3>
                    </div>
                    <div class="p-5 flex flex-col gap-6 overflow-y-auto max-h-[400px]">
                        <!-- Insight Item 1 -->
                        <div>
                            <h4 class="text-sm font-bold text-slate-900 dark:text-white mb-2">Positive Trajectory</h4>
                            <p class="text-sm text-slate-500 leading-relaxed">
                                Based on current receivables, cash flow remains positive through Q4. The uptick in mid-November correlates with expected Q3 contract renewals.
                            </p>
                        </div>
                        <div class="w-full h-px bg-slate-100 dark:bg-slate-800"></div>
                        <!-- Insight Item 2: Alert -->
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="text-sm font-bold text-slate-900 dark:text-white">Upcoming Anomalies</h4>
                                <span class="px-2 py-0.5 bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400 text-[10px] font-bold rounded uppercase">Action Needed</span>
                            </div>
                            <ul class="space-y-3">
                                <li class="flex gap-3 items-start p-3 bg-red-50 dark:bg-red-900/10 rounded-lg border border-red-100 dark:border-red-900/20">
                                    <span class="material-symbols-outlined text-red-500 text-lg mt-0.5">warning</span>
                                    <div>
                                        <p class="text-xs font-bold text-red-800 dark:text-red-300">Tax Payment Due</p>
                                        <p class="text-xs text-red-600 dark:text-red-400 mt-0.5">Nov 15 - Est. $24,000</p>
                                    </div>
                                </li>
                                <li class="flex gap-3 items-start p-3 bg-white dark:bg-surface-dark rounded-lg">
                                    <span class="material-symbols-outlined text-slate-500 text-lg mt-0.5">event</span>
                                    <div>
                                        <p class="text-xs font-bold text-slate-900 dark:text-white">Software Renewal</p>
                                        <p class="text-xs text-slate-500 mt-0.5">Dec 01 - Est. $5,200</p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="w-full h-px bg-slate-100 dark:bg-slate-800"></div>
                        <!-- Key Variables -->
                        <div>
                            <h4 class="text-sm font-bold text-slate-900 dark:text-white mb-3">Key Variables</h4>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="p-2 border border-slate-200 dark:border-slate-800 rounded bg-slate-50 dark:bg-slate-800/50">
                                    <span class="block text-[10px] text-slate-500 uppercase">Growth Rate</span>
                                    <span class="block text-sm font-bold text-slate-900 dark:text-white">5.0%</span>
                                </div>
                                <div class="p-2 border border-slate-200 dark:border-slate-800 rounded bg-slate-50 dark:bg-slate-800/50">
                                    <span class="block text-[10px] text-slate-500 uppercase">Churn Rate</span>
                                    <span class="block text-sm font-bold text-slate-900 dark:text-white">1.2%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
